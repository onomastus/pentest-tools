#!/bin/python3

import sys #Enter command line arguments (+other things)
import socket
import threading
from queue import Queue

print_lock = threading.Lock()

# Define target
target = sys.argv[1]

# Test ports
def portscan(port):
	s = socket.socket(socket.AF_INET, socket.SOCK_STREAM) #AF_INET: IPv4, SOCK_STREAM: Port
	socket.setdefaulttimeout(1) #In seconds
	try:
		con = s.connect((target,port))
		with print_lock:
			print(port)
		con.close()
	except:
		pass

def threader():
	while True:
		worker = q.get()
		portscan(worker)
		q.task_done()

q = Queue()

# How many threads
for x in range(50):
	t = threading.Thread(target=threader)
	t.daemon = True
	t.start()

# Port range (first,last+1)
for worker in range(1,65536):
	q.put(worker)

# Wait until the thread terminates
q.join()
