#!/bin/bash

echo "This script will take some time. Use \"du -s data\" in an other tab to see the size decreasing."

echo "Removing lines with empty passwords"
for file in $(find data -type f); do
	if [ $(basename $file) != "index.html" ]; then
		grep -v ':$' $file > tmp.txt
		mv tmp.txt $file
	fi
done

echo "Removing lines with non-ASCII characters"
for file in $(find data -type f); do
	if [ $(basename $file) != "index.html" ]; then
		perl -nle 'print if m{^[[:ascii:]]+$}' $file > tmp.txt
		mv tmp.txt $file
	fi
done
